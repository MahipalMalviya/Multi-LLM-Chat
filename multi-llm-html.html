<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MultiLLM Chat</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{background:#0d1117;color:#e6edf3;font-family:system-ui,sans-serif;height:100vh;overflow:hidden}
  ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#30363d;border-radius:3px}
  @keyframes bounce{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-6px)}}
  textarea:focus,input:focus{border-color:#58a6ff !important}
  button:hover{filter:brightness(1.1)}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useRef, useEffect } = React;

const PROVIDERS = [
  { id:"anthropic", name:"Anthropic", color:"#c9500f", icon:"üü†",
    baseURL:"https://api.anthropic.com/v1/messages",
    models:["claude-opus-4-6","claude-sonnet-4-6","claude-haiku-4-5-20251001"],
    apiKeyPlaceholder:"sk-ant-..." },
  { id:"openai", name:"OpenAI", color:"#10a37f", icon:"üü¢",
    baseURL:"https://api.openai.com/v1/chat/completions",
    models:["gpt-4o","gpt-4o-mini","gpt-4-turbo","o1","o1-mini"],
    apiKeyPlaceholder:"sk-..." },
  { id:"google", name:"Google Gemini", color:"#4285f4", icon:"üîµ",
    baseURL:"https://generativelanguage.googleapis.com/v1beta/models",
    models:["gemini-1.5-pro","gemini-1.5-flash","gemini-2.0-flash"],
    apiKeyPlaceholder:"AIza..." },
  { id:"qwen", name:"Qwen", color:"#6c5ce7", icon:"üü£",
    baseURL:"https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
    models:["qwen-max","qwen-plus","qwen-turbo"],
    apiKeyPlaceholder:"sk-..." },
  { id:"groq", name:"Groq (LLaMA)", color:"#e17055", icon:"ü¶ô",
    baseURL:"https://api.groq.com/openai/v1/chat/completions",
    models:["llama-3.3-70b-versatile","llama-3.1-8b-instant","mixtral-8x7b-32768"],
    apiKeyPlaceholder:"gsk_..." },
  { id:"mistral", name:"Mistral", color:"#fd79a8", icon:"üí´",
    baseURL:"https://api.mistral.ai/v1/chat/completions",
    models:["mistral-large-latest","mistral-small-latest","open-mixtral-8x7b"],
    apiKeyPlaceholder:"..." },
  { id:"cohere", name:"Cohere", color:"#00b894", icon:"üåä",
    baseURL:"https://api.cohere.ai/v1/chat",
    models:["command-r-plus","command-r"],
    apiKeyPlaceholder:"..." },
  { id:"deepseek", name:"DeepSeek", color:"#74b9ff", icon:"üî≠",
    baseURL:"https://api.deepseek.com/v1/chat/completions",
    models:["deepseek-chat","deepseek-reasoner"],
    apiKeyPlaceholder:"sk-..." },
  { id:"xai", name:"xAI (Grok)", color:"#fdcb6e", icon:"‚ö°",
    baseURL:"https://api.x.ai/v1/chat/completions",
    models:["grok-2-latest","grok-2-mini"],
    apiKeyPlaceholder:"xai-..." }
];

async function callLLM(provider, model, messages, apiKey) {
  if (provider.id === "anthropic") {
    const res = await fetch("https://api.anthropic.com/v1/messages", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({model, max_tokens:2048, messages})
    });
    const data = await res.json();
    if (data.error) throw new Error(data.error.message);
    return data.content?.[0]?.text || "";
  }
  if (provider.id === "google") {
    const geminiMsgs = messages.map(m=>({
      role: m.role==="assistant"?"model":"user",
      parts:[{text:m.content}]
    }));
    const res = await fetch(`${provider.baseURL}/${model}:generateContent?key=${apiKey}`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({contents:geminiMsgs})
    });
    const data = await res.json();
    if (data.error) throw new Error(data.error.message);
    return data.candidates?.[0]?.content?.parts?.[0]?.text || "";
  }
  if (provider.id === "cohere") {
    const history = messages.slice(0,-1).map(m=>({
      role: m.role==="assistant"?"CHATBOT":"USER",
      message:m.content
    }));
    const last = messages[messages.length-1];
    const res = await fetch(provider.baseURL,{
      method:"POST",
      headers:{"Content-Type":"application/json","Authorization":`Bearer ${apiKey}`},
      body:JSON.stringify({model, message:last.content, chat_history:history})
    });
    const data = await res.json();
    if (data.message) throw new Error(data.message);
    return data.text || "";
  }
  // OpenAI-compatible
  const res = await fetch(provider.baseURL,{
    method:"POST",
    headers:{"Content-Type":"application/json","Authorization":`Bearer ${apiKey}`},
    body:JSON.stringify({model, messages, max_tokens:2048})
  });
  const data = await res.json();
  if (data.error) throw new Error(data.error.message);
  return data.choices?.[0]?.message?.content || "";
}

function renderMarkdown(text) {
  return text
    .replace(/```(\w*)\n?([\s\S]*?)```/g,(_,lang,code)=>
      `<pre style="background:#0d1117;border:1px solid #30363d;border-radius:6px;padding:12px;overflow-x:auto;margin:8px 0"><code style="color:#e6edf3;font-family:monospace;font-size:13px">${code.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code></pre>`)
    .replace(/`([^`]+)`/g,`<code style="background:#161b22;color:#ff7b72;padding:2px 5px;border-radius:3px;font-family:monospace">$1</code>`)
    .replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>")
    .replace(/\*(.+?)\*/g,"<em>$1</em>")
    .replace(/^### (.+)$/gm,`<h3 style="color:#79c0ff;margin:8px 0 4px">$1</h3>`)
    .replace(/^## (.+)$/gm,`<h2 style="color:#79c0ff;margin:10px 0 5px">$1</h2>`)
    .replace(/^# (.+)$/gm,`<h1 style="color:#79c0ff;margin:12px 0 6px">$1</h1>`)
    .replace(/^[-*] (.+)$/gm,`<li style="margin:2px 0;list-style:disc;margin-left:20px">$1</li>`)
    .replace(/\n/g,"<br>");
}

function App() {
  const [apiKeys, setApiKeys] = useState({});
  const [selectedProvider, setSelectedProvider] = useState(PROVIDERS[0]);
  const [selectedModel, setSelectedModel] = useState(PROVIDERS[0].models[0]);
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState("");
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [showSettings, setShowSettings] = useState(false);
  const [copied, setCopied] = useState(null);
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const bottomRef = useRef();
  const textareaRef = useRef();

  useEffect(()=>{ bottomRef.current?.scrollIntoView({behavior:"smooth"}); },[messages,loading]);

  const apiKey = apiKeys[selectedProvider.id] || "";

  const send = async () => {
    if (!input.trim() || loading) return;
    if (selectedProvider.id !== "anthropic" && !apiKey) {
      setError(`Please add your ${selectedProvider.name} API key in ‚öôÔ∏è Settings.`);
      return;
    }
    const userMsg = {role:"user", content:input.trim()};
    const newMsgs = [...messages, userMsg];
    setMessages(newMsgs);
    setInput("");
    if (textareaRef.current) textareaRef.current.style.height = "auto";
    setLoading(true);
    setError("");
    try {
      const reply = await callLLM(selectedProvider, selectedModel, newMsgs, apiKey);
      setMessages(prev=>[...prev,{role:"assistant",content:reply}]);
    } catch(e) {
      setError(e.message || "Something went wrong.");
    }
    setLoading(false);
  };

  const copy = (text,idx) => {
    navigator.clipboard.writeText(text);
    setCopied(idx);
    setTimeout(()=>setCopied(null),2000);
  };

  const S = {
    app:{display:"flex",height:"100vh",overflow:"hidden"},
    sidebar:{width:260,background:"#161b22",borderRight:"1px solid #30363d",display:"flex",flexDirection:"column",flexShrink:0},
    sidebarHeader:{padding:"16px",borderBottom:"1px solid #30363d"},
    sidebarTitle:{fontSize:18,fontWeight:700},
    sidebarSub:{fontSize:11,color:"#8b949e",marginTop:2},
    sidebarBody:{padding:12,overflowY:"auto",flex:1},
    sectionLabel:{fontSize:11,color:"#8b949e",marginBottom:8,textTransform:"uppercase",letterSpacing:1},
    sidebarFooter:{padding:12,borderTop:"1px solid #30363d",display:"flex",gap:8},
    footerBtn:{flex:1,padding:"7px",borderRadius:6,background:"#21262d",border:"1px solid #30363d",color:"#e6edf3",cursor:"pointer",fontSize:12},
    main:{flex:1,display:"flex",flexDirection:"column",minWidth:0},
    header:{padding:"12px 16px",borderBottom:"1px solid #30363d",display:"flex",alignItems:"center",gap:12,background:"#161b22"},
    menuBtn:{background:"none",border:"none",color:"#8b949e",cursor:"pointer",fontSize:18,padding:0},
    modelBadge:{fontSize:12,color:"#8b949e",background:"#21262d",padding:"2px 8px",borderRadius:12},
    msgArea:{flex:1,overflowY:"auto",padding:"16px",display:"flex",flexDirection:"column",gap:16},
    emptyWrap:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#8b949e",textAlign:"center"},
    inputWrap:{padding:"12px 16px",borderTop:"1px solid #30363d",background:"#161b22"},
    inputRow:{display:"flex",gap:8,alignItems:"flex-end"},
    textarea:{flex:1,background:"#21262d",border:"1px solid #30363d",borderRadius:10,padding:"10px 14px",color:"#e6edf3",fontSize:14,outline:"none",resize:"none",fontFamily:"inherit",lineHeight:1.5,maxHeight:120,overflowY:"auto"},
    overlay:{position:"fixed",inset:0,background:"#00000088",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100},
    modal:{background:"#161b22",border:"1px solid #30363d",borderRadius:12,padding:24,width:480,maxHeight:"80vh",overflowY:"auto"},
    modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},
    closeBtn:{background:"none",border:"none",color:"#8b949e",cursor:"pointer",fontSize:18},
    notice:{fontSize:12,color:"#8b949e",marginBottom:16,padding:"8px 12px",background:"#0d1117",borderRadius:6},
    keyInput:{width:"100%",background:"#21262d",border:"1px solid #30363d",borderRadius:6,padding:"8px 12px",color:"#e6edf3",fontSize:13,outline:"none"},
    saveBtn:{width:"100%",padding:10,background:"#238636",border:"none",borderRadius:8,color:"#fff",cursor:"pointer",fontWeight:600,marginTop:8},
  };

  return (
    <div style={S.app}>
      {sidebarOpen && (
        <div style={S.sidebar}>
          <div style={S.sidebarHeader}>
            <div style={S.sidebarTitle}>ü§ñ MultiLLM</div>
            <div style={S.sidebarSub}>Chat with any AI model</div>
          </div>
          <div style={S.sidebarBody}>
            <div style={S.sectionLabel}>Provider</div>
            {PROVIDERS.map(p=>(
              <div key={p.id} onClick={()=>{setSelectedProvider(p);setSelectedModel(p.models[0]);setMessages([]);setError("");}}
                style={{display:"flex",alignItems:"center",gap:8,padding:"8px 10px",borderRadius:6,cursor:"pointer",marginBottom:2,
                  background:selectedProvider.id===p.id?"#21262d":"transparent",
                  border:selectedProvider.id===p.id?`1px solid ${p.color}44`:"1px solid transparent"}}>
                <span style={{fontSize:16}}>{p.icon}</span>
                <span style={{fontSize:13,fontWeight:selectedProvider.id===p.id?600:400}}>{p.name}</span>
                {selectedProvider.id===p.id && !apiKeys[p.id] && p.id!=="anthropic" &&
                  <span style={{marginLeft:"auto",fontSize:10,color:"#f85149"}}>‚ö†Ô∏è</span>}
              </div>
            ))}
            <div style={{...S.sectionLabel,margin:"12px 0 8px"}}>Model</div>
            {selectedProvider.models.map(m=>(
              <div key={m} onClick={()=>setSelectedModel(m)}
                style={{padding:"7px 10px",borderRadius:6,cursor:"pointer",marginBottom:2,fontSize:12,
                  background:selectedModel===m?"#21262d":"transparent",
                  color:selectedModel===m?selectedProvider.color:"#8b949e",
                  border:selectedModel===m?`1px solid ${selectedProvider.color}44`:"1px solid transparent"}}>
                {m}
              </div>
            ))}
          </div>
          <div style={S.sidebarFooter}>
            <button style={S.footerBtn} onClick={()=>setShowSettings(true)}>‚öôÔ∏è API Keys</button>
            <button style={S.footerBtn} onClick={()=>{setMessages([]);setError("");}}>üóëÔ∏è Clear</button>
          </div>
        </div>
      )}

      <div style={S.main}>
        <div style={S.header}>
          <button style={S.menuBtn} onClick={()=>setSidebarOpen(s=>!s)}>‚ò∞</button>
          <span style={{fontSize:14,color:selectedProvider.color}}>{selectedProvider.icon} {selectedProvider.name}</span>
          <span style={S.modelBadge}>{selectedModel}</span>
        </div>

        <div style={S.msgArea}>
          {messages.length===0 && (
            <div style={S.emptyWrap}>
              <div style={{fontSize:48,marginBottom:12}}>{selectedProvider.icon}</div>
              <div style={{fontSize:20,fontWeight:600,color:"#e6edf3",marginBottom:6}}>Chat with {selectedProvider.name}</div>
              <div style={{fontSize:13}}>Model: {selectedModel}</div>
              {selectedProvider.id!=="anthropic" && !apiKey &&
                <div style={{marginTop:12,padding:"8px 14px",background:"#f8514920",border:"1px solid #f85149",borderRadius:8,fontSize:12,color:"#f85149"}}>
                  ‚ö†Ô∏è Add your API key in Settings to start chatting
                </div>}
            </div>
          )}

          {messages.map((msg,i)=>(
            <div key={i} style={{display:"flex",gap:10,flexDirection:msg.role==="user"?"row-reverse":"row"}}>
              <div style={{width:32,height:32,borderRadius:"50%",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,
                background:msg.role==="user"?"#21262d":selectedProvider.color+"33",
                border:`1px solid ${msg.role==="user"?"#30363d":selectedProvider.color+"66"}`}}>
                {msg.role==="user"?"üë§":selectedProvider.icon}
              </div>
              <div style={{maxWidth:"75%",position:"relative"}}>
                <div style={{padding:"10px 14px",borderRadius:msg.role==="user"?"18px 4px 18px 18px":"4px 18px 18px 18px",
                  background:msg.role==="user"?"#21262d":"#161b22",
                  border:`1px solid ${msg.role==="user"?"#30363d":selectedProvider.color+"33"}`,
                  fontSize:14,lineHeight:1.6}}
                  dangerouslySetInnerHTML={{__html:renderMarkdown(msg.content)}}/>
                <button onClick={()=>copy(msg.content,i)}
                  style={{position:"absolute",top:4,right:msg.role==="user"?"auto":4,left:msg.role==="user"?4:"auto",
                    background:"#21262d",border:"1px solid #30363d",color:"#8b949e",borderRadius:4,padding:"2px 6px",cursor:"pointer",fontSize:10,opacity:0.7}}>
                  {copied===i?"‚úì Copied":"Copy"}
                </button>
              </div>
            </div>
          ))}

          {loading && (
            <div style={{display:"flex",gap:10}}>
              <div style={{width:32,height:32,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,
                background:selectedProvider.color+"33",border:`1px solid ${selectedProvider.color}66`}}>{selectedProvider.icon}</div>
              <div style={{padding:"12px 16px",background:"#161b22",border:`1px solid ${selectedProvider.color}33`,borderRadius:"4px 18px 18px 18px"}}>
                <span style={{display:"inline-flex",gap:4}}>
                  {[0,1,2].map(i=><span key={i} style={{width:6,height:6,borderRadius:"50%",background:selectedProvider.color,
                    display:"inline-block",animation:`bounce 1.2s ${i*0.2}s infinite`}}/>)}
                </span>
              </div>
            </div>
          )}

          {error && (
            <div style={{padding:"10px 14px",background:"#f8514920",border:"1px solid #f85149",borderRadius:8,color:"#f85149",fontSize:13}}>
              ‚ùå {error}
            </div>
          )}
          <div ref={bottomRef}/>
        </div>

        <div style={S.inputWrap}>
          <div style={S.inputRow}>
            <textarea ref={textareaRef} value={input} onChange={e=>setInput(e.target.value)}
              onKeyDown={e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();send();}}}
              placeholder={`Message ${selectedProvider.name}... (Enter to send, Shift+Enter for newline)`}
              rows={1} style={S.textarea}
              onInput={e=>{e.target.style.height="auto";e.target.style.height=Math.min(e.target.scrollHeight,120)+"px";}}/>
            <button onClick={send} disabled={loading||!input.trim()}
              style={{padding:"10px 18px",borderRadius:10,background:selectedProvider.color,border:"none",
                color:"#fff",cursor:loading||!input.trim()?"not-allowed":"pointer",fontSize:14,fontWeight:600,
                opacity:loading||!input.trim()?0.5:1,whiteSpace:"nowrap"}}>
              {loading?"...":"Send ‚Üë"}
            </button>
          </div>
        </div>
      </div>

      {showSettings && (
        <div style={S.overlay}>
          <div style={S.modal}>
            <div style={S.modalHeader}>
              <div style={{fontSize:16,fontWeight:700}}>‚öôÔ∏è API Keys</div>
              <button style={S.closeBtn} onClick={()=>setShowSettings(false)}>‚úï</button>
            </div>
            <div style={S.notice}>üîí Keys are stored in memory only and cleared on page refresh.</div>
            {PROVIDERS.map(p=>(
              <div key={p.id} style={{marginBottom:14}}>
                <label style={{fontSize:12,color:"#8b949e",display:"block",marginBottom:4}}>
                  {p.icon} {p.name} {p.id==="anthropic"?"(No key needed ‚Äî auto-configured)":""}
                </label>
                <input type="password" value={apiKeys[p.id]||""} disabled={p.id==="anthropic"}
                  onChange={e=>setApiKeys(k=>({...k,[p.id]:e.target.value}))}
                  placeholder={p.id==="anthropic"?"Auto-configured":p.apiKeyPlaceholder}
                  style={{...S.keyInput,opacity:p.id==="anthropic"?0.5:1,background:p.id==="anthropic"?"#0d1117":"#21262d"}}/>
              </div>
            ))}
            <button style={S.saveBtn} onClick={()=>setShowSettings(false)}>‚úÖ Save & Close</button>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
